<!DOCTYPE html>
<html lang="es">
<head>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/Em_css/Em_Hordenes.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/Global_css/menu.css') }}">
</head>
<body>
  <div class="sidebar">
    <div class="logo">
      <img src="{{ url_for('static', filename='image/logo.png') }}" alt="Ichiraku Logo">
    </div>
    <nav class="menu">
      <button onclick="window.location.href='{{ url_for('Em_Inicio') }}'" class="menu-button">
        <img src="{{ url_for('static', filename='image/casita.png') }}"> Inicio
      </button>
      <button onclick="window.location.href='{{ url_for('Em_Rordenes') }}'" class="menu-button">
        <img src="{{ url_for('static', filename='image/caja.png') }}"> Recibir pedidos
      </button>
      <button onclick="window.location.href='{{ url_for('Em_Rpedido') }}'" class="menu-button">
        <img src="{{ url_for('static', filename='image/carrito_super.png') }}"> Realizar pedidos
      </button>
      <button onclick="window.location.href='{{ url_for('Em_Hordenes') }}'" class="menu-button active">
        <img src="{{ url_for('static', filename='image/reloj.png') }}"> Historial pedidos
      </button>
      <button onclick="window.location.href='{{ url_for('Em_Ceditar') }}'" class="menu-button">
        <img src="{{ url_for('static', filename='image/corazon.png') }}"> Usuario
      </button>
    </nav>
    <button class="logout-btn" onclick="window.location.href='/logout'">Cerrar sesi√≥n</button>
  </div>

  <main class="content">
    <div class="box-welcome">
      <h1 class="welcome-title">Historial de Pedidos</h1>
    </div>

    <!-- üîç Barra de b√∫squeda -->
    <form class="search-box" id="formBuscar" method="GET" action="{{ url_for('Em_Hordenes') }}">
      <input type="date" name="fecha" id="buscarFecha" class="ninja-input" value="{{ request.args.get('fecha', '') }}">
      
      <select name="categoria" id="buscarCategoria" class="ninja-select">
        <option value="">Todas las categor√≠as</option>
        {% for cat in ["Carnes","Bebidas","Verduras","Frutas","Cereales","Salsas y condimentos","Panes y masas","Mariscos","Lacteos"] %}
          <option value="{{ cat }}" {% if request.args.get('categoria') == cat %}selected{% endif %}>{{ cat }}</option>
        {% endfor %}
      </select>

      <input type="text" name="producto" id="buscarProducto" class="ninja-input" placeholder="üîé Producto..." value="{{ request.args.get('producto', '') }}">
      <input type="number" name="cantidad" id="buscarCantidad" class="ninja-input" placeholder="Cantidad" value="{{ request.args.get('cantidad', '') }}">

      <select name="unidad" id="buscarUnidad" class="ninja-select">
        <option value="">Todas las unidades</option>
        {% for uni in ["kg","g","L","ml","unidad","docena"] %}
          <option value="{{ uni }}" {% if request.args.get('unidad') == uni %}selected{% endif %}>{{ uni }}</option>
        {% endfor %}
      </select>

      <button type="submit" class="ninja-btn">Buscar</button>
    </form>

    <!-- üßæ Panel de pedidos -->
    <div class="order-panel" id="tablaPedidos">
      <div class="order-header">
        <span>Fecha</span>
        <span>Categor√≠a</span>
        <span>Producto</span>
        <span>Cantidad</span>
        <span>Unidad</span>
      </div>

      {% if pedidos %}
        {% for pedido in pedidos %}
          {% for detalle in pedido.detalle_pedido %}
            <div class="order-row">
              <span class="col-fecha">{{ pedido.fecha_pedido or "Sin fecha" }}</span>
              <span class="col-categoria">{{ detalle.productos.categoria or "Sin categor√≠a" }}</span>
              <span class="col-producto">{{ detalle.productos.nombre or "Sin nombre" }}</span>
              <span class="col-cantidad">{{ detalle.cantidad or "0" }}</span>
              <span class="col-unidad">{{ detalle.productos.unidad or "-" }}</span>
            </div>
          {% endfor %}
        {% endfor %}
      {% else %}
        <div class="no-orders"><p>No hay pedidos confirmados üí§</p></div>
      {% endif %}
    </div>
  </main>

  <script src="{{ url_for('static', filename='js/Em_js/Em_Hordenes.js') }}"></script>
</body>
</html>
