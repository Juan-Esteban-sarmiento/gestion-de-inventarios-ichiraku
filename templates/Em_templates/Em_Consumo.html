<!DOCTYPE html>
<html lang="es">

<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/Em_css/Em_Consumo.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/Global_css/menu.css') }}">
    <script src="{{ url_for('static', filename='js/Global_js/session_timeout.js') }}"></script>
    <meta charset="UTF-8">
    <title>Ichiraku Ramen - Registrar Consumo</title>
</head>

<body>
    <div class="sidebar">
        <div class="user-profile">
            <img src="{{ session.get('foto') or url_for('static', filename='image/default.png') }}" alt="Foto"
                class="user-avatar"
                onerror="this.onerror=null; this.src='{{ url_for('static', filename='image/default.png') }}';">
            <span class="user-name">{{ session.get('nombre', 'Usuario') }}</span>
            <span class="user-role">{{ session.get('role', '') }}</span>
            {% if session.get('role') == 'Empleado' %}
            <div class="branch-badge">
                <span class="branch-icon"></span>
                <span class="branch-name">{{ session.get('branch_name', 'Sin local') }}</span>
            </div>
            {% endif %}
        </div>

        <nav class="menu">
            <button onclick="window.location.href='{{ url_for('Em_Inicio') }}'" class="menu-button">
                <img src="{{ url_for('static', filename='image/casita.png') }}" alt="Inicio"> Inicio
            </button>

            <button onclick="window.location.href='{{ url_for('Em_Consumo') }}' " class="menu-button active">
                <img src="{{ url_for('static', filename='image/consumer.png') }}" alt="Informes"> Consumo
            </button>
            <button onclick="window.location.href='{{ url_for('Em_Inventario') }}'" class="menu-button">
                <img src="{{ url_for('static', filename='image/caja.png') }}" alt="Inventario"> Inventario
            </button>
            <button onclick="window.location.href='{{ url_for('Em_Rordenes') }}'" class="menu-button">
                <img src="{{ url_for('static', filename='image/carrito_super.png') }}" alt="Informes"> Pedidos
            </button>
            <button onclick="window.location.href='{{ url_for('Em_Rpedido') }}'" class="menu-button">
                <img src="{{ url_for('static', filename='image/online-sale.png') }}" alt="Realizar pedidos"> Realizar
                pedidos
            </button>
            <button onclick="window.location.href='{{ url_for('Em_Hordenes') }}'" class="menu-button">
                <img src="{{ url_for('static', filename='image/reloj.png') }}" alt="Historial pedidos"> Historial
                pedidos
            </button>
            <button onclick="window.location.href='{{ url_for('Em_Ceditar') }}'" class="menu-button">
                <img src="{{ url_for('static', filename='image/corazon.png') }}" alt="Usuario"> Usuario
            </button>
        </nav>
        <button class="logout-btn" onclick="window.location.href='/logout'">Cerrar sesion</button>
    </div>

    <main class="content">
        <div id="messageArea"></div>

        <!-- Header -->
        <div class="box-welcome">
            <h1 class="welcome-title">Registrar Venta de Platos</h1>
        </div>

        <!-- Panel principal -->
        <div class="order-panel">
            <!-- Sección 1: Búsqueda de Platos (Recetas) -->
            <div class="product-selection-section">
                <div class="order-header">
                    <span>Buscar Platos</span>
                </div>
                <div class="search-controls">
                    <input type="text" id="searchTerm" placeholder="Nombre del plato...">
                    <button class="confirm-btn search-btn" onclick="buscarProductos()">Buscar</button>
                </div>

                <!-- Grid de platos -->
                <div id="productos-container" class="productos-grid">
                    <!-- Cargados vía JS -->
                </div>
            </div>

            <!-- Sección 2: Carrito de Consumo con Desglose -->
            <div class="pedido-box">
                <div class="pedido-header">
                    <h2>Platos Seleccionados</h2>
                    <span class="consumo-badge" id="consumo-count">0</span>
                </div>
                <ul id="consumo-lista">
                    <li class="empty-cart">
                        <p>Agrega platos para registrar consumo</p>
                    </li>
                </ul>
                <button class="confirm-btn register-btn" onclick="confirmarConsumo()">Registrar Venta</button>
            </div>

            <!-- Sección 3: Comparativa de Inventario -->
            <div class="comparativa-box">
                <div class="pedido-header">
                    <h2>Análisis Comparativo</h2>
                </div>
                <div class="comparativa-content">
                    <table class="comparativa-table">
                        <thead>
                            <tr>
                                <th>Producto</th>
                                <th>Consumo Hoy</th>
                                <th>Stock Actual</th>
                            </tr>
                        </thead>
                        <tbody id="comparativa-tbody">
                            <!-- Cargado vía JS -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Historial del Día -->
        <div class="historial-section">
            <div class="historial-header">
                <h2>Consumos de Hoy</h2>
                <button class="refresh-btn" onclick="cargarHistorialHoy()" title="Refrescar">↻</button>
            </div>

            <div class="historial-table-wrapper">
                <table class="historial-table">
                    <thead>
                        <tr>
                            <th>Hora</th>
                            <th>Producto</th>
                            <th>Cantidad</th>
                            <th>Unidad</th>
                            <th>Empleado</th>
                        </tr>
                    </thead>
                    <tbody id="historial-tbody">
                    </tbody>
                </table>

                <div id="historial-empty" class="empty-state" style="display: flex;">
                    <p>No hay consumos registrados hoy</p>
                </div>
            </div>
        </div>

        <!-- Logo circular respiratorio -->
        <div class="logo-main">
            <img src="{{ url_for('static', filename='image/logo.png') }}" alt="Ichiraku Ramen">
        </div>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="{{ url_for('static', filename='js/Global_js/alertaNinja.js') }}"></script>
    <script src="{{ url_for('static', filename='js/Em_js/Consumo.js') }}"></script>
</body>

</html>